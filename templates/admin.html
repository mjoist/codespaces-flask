{% extends 'base.html' %}
{% block content %}
<h1>{{ _('user_management') }}</h1>
<form action="{{ url_for('create_user') }}" method="post" class="two-column">
<p><input type="text" name="username" placeholder="Username" required></p>
<p><input type="password" name="password" placeholder="Password" required></p>
<p>
    <select name="role_id">
        <option value="">---</option>
        {% for r in roles %}
            <option value="{{ r.id }}">{{ r.name }}</option>
        {% endfor %}
    </select>
</p>
<p>
    <select name="profile_id">
        <option value="">---</option>
        {% for p in profiles %}
            <option value="{{ p.id }}">{{ p.name }}</option>
        {% endfor %}
    </select>
</p>
<p><button type="submit">Create User</button></p>
</form>
<table>
<tr><th>User</th><th>Role</th><th>Profile</th><th>Action</th></tr>
{% for user in users %}
<tr>
<form action="{{ url_for('update_user', user_id=user.id) }}" method="post">
    <td>{{ user.username }}</td>
    <td>
        <select name="role_id">
            <option value="">---</option>
            {% for r in roles %}
                <option value="{{ r.id }}" {% if user.role_id == r.id %}selected{% endif %}>{{ r.name }}</option>
            {% endfor %}
        </select>
    </td>
    <td>
        <select name="profile_id">
            <option value="">---</option>
            {% for p in profiles %}
                <option value="{{ p.id }}" {% if user.profile_id == p.id %}selected{% endif %}>{{ p.name }}</option>
            {% endfor %}
        </select>
    </td>
    <td>
        {% if not user.is_admin %}
        <button type="submit">Update</button>
        </form>
        <form action="{{ url_for('delete_user', user_id=user.id) }}" method="post" style="display:inline;">
            <button type="submit">Delete</button>
        </form>
        {% else %}
        </form>
        {% endif %}
    </td>
</tr>
{% endfor %}
</table>
{% endblock %}
